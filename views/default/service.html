{% extends "base.html" %}

{% block js %}
    <script type="text/javascript">
      $(document).ready(function(){
        $(".button").button();
        $(".delete-event").click(function(event){
          event.preventDefault();
          $.ajax({ 
            type: "DELETE",
            data: {},
            url: $(this).attr("href"), 
            context: $(this).parent().parent(), 
            success: function(){
                  $(this).fadeOut('fast', function(){
                    $(this).remove();
                  });
                },
            error: function(){
                  alert("CRAP");
                },
            });
        });
      });
    </script>
{% endblock %}

{% block content %}
        
      <div id="services">
        <h2>
          {{ service.name }}
        </h2>
        
        <h3 class="date-range">
          {% if start_date %}
            {{ start_date|date:"n/j/Y"  }}
          {% endif %}

          {% if end_date %}
             - {{ end_date|date:"n/j/Y"  }}
          {% endif %}
        </h3>
        
        {% if user_is_admin %}
        <div id="submit">
          <form method="post">
            <label id="statusLabel" for="status">Status:</label>
            <select class="update-status" name="severity">
              {% for status in statuses %}
                <option selected  name="severity" value="{{ status.key }}">{{ status.name|capfirst }}</option>
              {% endfor %}
            </select>
            <label id="messageLabel" for="message">Message:</label>
            <textarea class="update-message" name="message"></textarea>

            <input class="update-submit" type="submit" 
              value="Add New Event"></input>
          </form>
        </div>
        {% endif %}
        
        <table class="event-log" cellpadding="10">
          <thead>
            <tr>
              <th class="time-header">Time</th>
              <th class="status-header">Status</th>
              <th>Message</th>
              {% if user_is_admin %}
                <th class="delete-header">Delete</th>
              {% endif %}
            </tr>
          </thead>
          {% for event in events %}
            <tr>
                <td>{{ event.start|date:"N j, fA"  }}</td>
                <td class="status highlight">
            <img src="/images/status/{{ event.status.image}}"
                    alt="{{ event.name }}"/>
                </td>
                <td>{{ event.message }}</td>
                
                {% if user_is_admin %}
                  <td class="delete"><a class="delete-event" 
                    href="/api/services/{{ service.slug }}/events/{{ event.sid }}/">
                    <img src="/images/status/minus-circle.png"
                            alt="Delete"/>
                  </a></td>
                {% endif %}
            </tr>
          {% endfor %}
        </table>
      </div>

{% endblock %}

